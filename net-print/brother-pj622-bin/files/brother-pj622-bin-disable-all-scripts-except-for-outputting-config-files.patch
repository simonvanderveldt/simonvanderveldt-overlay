From e21bd35cc9a82926279afa026ad60c233f0d9d8b Mon Sep 17 00:00:00 2001
From: Simon van der Veldt <simon.vanderveldt@gmail.com>
Date: Fri, 8 Dec 2017 12:34:09 +0100
Subject: [PATCH] Disable all scripts except for outputting config files

---
 opt/brother/PTouch/pj622/cupswrapper/cupswrapperpj622pt1 | 46 ++++++++++++++++++++++++++--------------------
 1 file changed, 26 insertions(+), 20 deletions(-)

diff --git a/opt/brother/PTouch/pj622/cupswrapper/cupswrapperpj622pt1 b/opt/brother/PTouch/pj622/cupswrapper/cupswrapperpj622pt1
index 05ec7d0..209424d 100755
--- a/opt/brother/PTouch/pj622/cupswrapper/cupswrapperpj622pt1
+++ b/opt/brother/PTouch/pj622/cupswrapper/cupswrapperpj622pt1
@@ -17,6 +17,7 @@
 # this program; if not, write to the Free Software Foundation, Inc., 59 Temple
 # Place, Suite 330, Boston, MA  02111-1307  USA
 #
+if /bin/false; then

 printer_model="pj622"
 printer_name=`echo $printer_model | tr '[a-z]' '[A-Z]'`
@@ -119,7 +120,9 @@ else
 fi
 #satyam comments

-cat <<ENDOFPPDFILE | tee $ppd_file_name >> $ppd_file_name1
+fi
+
+cat <<ENDOFPPDFILE > brother_pj622_printer_en.ppd
 *PPD-Adobe: "4.3"

 *%================================================
@@ -452,6 +455,7 @@ cat <<ENDOFPPDFILE | tee $ppd_file_name >> $ppd_file_name1

 ENDOFPPDFILE

+if /bin/false; then
 brotherlpdwrapper=/usr/lib/cups/filter/brother_lpdwrapper_${printer_model}
 brotherlpdwrapper64=/usr/lib64/cups/filter/brother_lpdwrapper_${printer_model}
 #brotherlpdwrapper=/usr/lib/cups/backend/brusb_${printer_model}
@@ -460,11 +464,12 @@ brotherlpdwrapper64=/usr/lib64/cups/filter/brother_lpdwrapper_${printer_model}
 rm -f  $brotherlpdwrapper
 #echo 'rm -f /usr/lib/cups/filter/brlpdwrapper${printer_model}'

+fi

-cat <<!ENDOFWFILTER! >$brotherlpdwrapper
+cat <<!ENDOFWFILTER! > brother_lpdwrapper_pj622
 #! /bin/sh
 #
-# Brother Print filter  >>  /usr/lib/cups/backend/brusb_${printer_model}
+# Brother Print filter
 # Copyright (C) 2006-2014 Brother. Industries, Ltd.
 #                                    Ver1.10

@@ -491,8 +496,8 @@ NUPENABLE=1
 LOG_LATESTONLY=1


-touch /tmp/${printer_model}_latest_print_info
-chmod 600 -R /tmp/${printer_model}_latest_print_info
+touch /tmp/pj622_latest_print_info
+chmod 600 -R /tmp/pj622_latest_print_info

 errorcode=0

@@ -504,7 +509,7 @@ PPDC=\`printenv | grep "PPD="\`
 PPDC=\`echo \$PPDC | sed -e 's/PPD=//'\`

 if [ "\$PPDC" = "" ]; then
-    PPDC="/usr/share/cups/model/Brother/brother_${printer_model}_printer_en.ppd"
+    PPDC="/usr/share/ppd/Brother/brother_pj622_printer_en.ppd"
 fi


@@ -529,9 +534,9 @@ if [ \$LOGFILE != "/dev/null" ]; then
     echo "PPD  = \$PPD"                                         >>\$LOGFILE
 fi

-cp  /opt/brother/${device_model}/${printer_model}/inf/br${printer_model}rc  /tmp/br${printer_model}rc_\$$
-chmod 777 -R /tmp/br${printer_model}rc_\$$
-export BRPRINTERRCFILE=/tmp/br${printer_model}rc_\$$
+cp  /opt/brother/PTouch/pj622/inf/brpj622rc  /tmp/brpj622rc_\$$
+chmod 777 -R /tmp/brpj622rc_\$$
+export BRPRINTERRCFILE=/tmp/brpj622rc_\$$

 INPUT_TEMP_PS=\`mktemp /tmp/br_input_ps.XXXXXX\`

@@ -578,11 +583,11 @@ else
 		cat    > \$INPUT_TEMP_PS
 	fi
 fi
-if [ -e "/opt/brother/${device_model}/${printer_model}/lpd/filter${printer_model}" ]; then
+if [ -e "/opt/brother/PTouch/pj622/lpd/filterpj622" ]; then
        :
 else
-    echo "ERROR: /opt/brother/${device_model}/${printer_model}/lpd/filter${printer_model} does not exist"   >>\$LOGFILE
-    echo "ERROR: /opt/brother/${device_model}/${printer_model}/lpd/filter${printer_model} does not exist"   >>/tmp/${printer_model}_latest_print_info
+    echo "ERROR: /opt/brother/PTouch/pj622/lpd/filterpj622 does not exist"   >>\$LOGFILE
+    echo "ERROR: /opt/brother/PTouch/pj622/lpd/filterpj622 does not exist"   >>/tmp/pj622_latest_print_info
     errorcode=30
     exit
 fi
@@ -596,19 +601,19 @@ if [ "\$BRURI" != "" ]; then
 	PORT="SERIAL"
 fi

-if [ -e "/opt/brother/${device_model}/${printer_model}/cupswrapper/brcupsconfpt1" ]; then
+if [ -e "/opt/brother/PTouch/pj622/cupswrapper/brcupsconfpt1" ]; then
   if [ \$DEBUG = 0 ]; then
-     /opt/brother/${device_model}/${printer_model}/cupswrapper/brcupsconfpt1  ${printer_model}  \$PPDC 0 "\$CUPSOPTION" \$BRPRINTERRCFILE>> /dev/null
+     /opt/brother/PTouch/pj622/cupswrapper/brcupsconfpt1  pj622  \$PPDC 0 "\$CUPSOPTION" \$BRPRINTERRCFILE>> /dev/null
   else
-     /opt/brother/${device_model}/${printer_model}/cupswrapper/brcupsconfpt1  ${printer_model}  \$PPDC \$LOGCLEVEL "\$CUPSOPTION" \$BRPRINTERRCFILE>>\$LOGFILE
+     /opt/brother/PTouch/pj622/cupswrapper/brcupsconfpt1  pj622  \$PPDC \$LOGCLEVEL "\$CUPSOPTION" \$BRPRINTERRCFILE>>\$LOGFILE
   fi
 fi

 if [ \$DEBUG -lt 10 ]; then
-    cat    \$INPUT_TEMP_PS | /opt/brother/${device_model}/${printer_model}/lpd/filter${printer_model} "\$\$" "CUPS" "\$PORT"
-    echo br${printer_model}rc_\$$   > /tmp/${printer_model}_latest_print_info
-    cat  /tmp/br${printer_model}rc_\$$  >> /tmp/${printer_model}_latest_print_info
-    rm -f /tmp/br${printer_model}rc_\$$
+    cat    \$INPUT_TEMP_PS | /opt/brother/PTouch/pj622/lpd/filterpj622 "\$\$" "CUPS" "\$PORT"
+    echo brpj622rc_\$$   > /tmp/pj622_latest_print_info
+    cat  /tmp/brpj622rc_\$$  >> /tmp/pj622_latest_print_info
+    rm -f /tmp/brpj622rc_\$$
     if [ \$LOGLEVEL -gt 2 ];  then
 	   if [ \$LOGFILE != "/dev/null" ]; then
 	     echo ""                                                >>\$LOGFILE
@@ -623,6 +628,7 @@ exit $errorcode

 !ENDOFWFILTER!

+if /bin/false; then
 chmod a+x $brotherlpdwrapper
 if [ -e /usr/lib64/cups/backend ]; then
     cp $brotherlpdwrapper  $brotherlpdwrapper64
@@ -700,4 +706,4 @@ echo lpadmin -p ${device_name} -E -v $URI -P $ppd_file_name
 lpadmin -p ${device_name} -E -v $URI -P $ppd_file_name

 exit 0
-
+fi
--
2.13.6
